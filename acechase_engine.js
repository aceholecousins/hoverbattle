var window=self;importScripts("./acechase_lib.js"),function(e){function t(t){for(var r,i,a=t[0],c=t[1],l=t[2],u=0,d=[];u<a.length;u++)i=a[u],Object.prototype.hasOwnProperty.call(n,i)&&n[i]&&d.push(n[i][0]),n[i]=0;for(r in c)Object.prototype.hasOwnProperty.call(c,r)&&(e[r]=c[r]);for(h&&h(t);d.length;)d.shift()();return o.push.apply(o,l||[]),s()}function s(){for(var e,t=0;t<o.length;t++){for(var s=o[t],r=!0,a=1;a<s.length;a++){var c=s[a];0!==n[c]&&(r=!1)}r&&(o.splice(t--,1),e=i(i.s=s[0]))}return e}var r={},n={1:0},o=[];function i(t){if(r[t])return r[t].exports;var s=r[t]={i:t,l:!1,exports:{}};return e[t].call(s.exports,s,s.exports,i),s.l=!0,s.exports}i.m=e,i.c=r,i.d=function(e,t,s){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)i.d(s,r,function(t){return e[t]}.bind(null,r));return s},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="";var a=window.webpackJsonp=window.webpackJsonp||[],c=a.push.bind(a);a.push=t,a=a.slice();for(var l=0;l<a.length;l++)t(a[l]);var h=c;o.push([72,0]),s()}({14:function(e,t,s){"use strict";s.d(t,"a",(function(){return o}));var r=s(2),n=s(3);class o{constructor(e={}){this.position=r.c.fromValues(0,0,0),this.orientation=r.a.fromValues(0,0,0,1),this.scaling=r.c.fromValues(1,1,1),this.kind=e.kind,Object(n.b)(this,e,["position","orientation","scaling"])}}},3:function(e,t,s){"use strict";function r(e,t,s){for(const r of s)e[r]=t[r]}function n(e,t,s){for(const r of s)r in t&&(e[r]=t[r])}s.d(t,"a",(function(){return r})),s.d(t,"b",(function(){return n}))},7:function(e,t,s){"use strict";s.d(t,"a",(function(){return n}));window.document,window.document;class r{constructor(e){this.worker=void 0,this.connected=!1,this.sendWhenConnected=!1,this.objectRegistry={},this.localOwnIndexCounter=1,this.localOtherIndexCounter=-1,this.remoteOwnIndexCounter=1,this.remoteOtherIndexCounter=-1,this.msgQueue=[],void 0!==e?(this.worker=new Worker(e),this.worker.onmessage=this.receive.bind(this)):(onmessage=this.receive.bind(this),this.enqueueMsg({kind:"ready"}),this.sendAll(),this.connected=!0)}enqueueMsg(e){this.msgQueue.push(e)}sendAll(){0!=this.msgQueue.length&&(void 0!==this.worker?this.connected?(this.worker.postMessage(this.msgQueue),this.msgQueue=[]):this.sendWhenConnected=!0:(postMessage(this.msgQueue),this.msgQueue=[]))}handleReady(){this.connected=!0,this.sendWhenConnected&&this.sendAll()}handleLinkage(e){let t=this.objectRegistry;for(let s of e.path){let e=t[s];"function"==typeof e&&(e=e.bind(t)),t=e}if("object"!=typeof t&&"function"!=typeof t)throw new Error("tried to link a field which is not an object or a method: "+e.path);this.objectRegistry[this.localOtherIndexCounter--]=t}handleCall(e){let t=this.objectRegistry[e.id](...this.resolveReferences(e.args));"object"==typeof t||"function"==typeof t?this.objectRegistry[this.localOtherIndexCounter--]=t:(void 0!==t&&console.warn("result of remotely called function will be ignored"),this.localOtherIndexCounter--)}handleNew(e){let t=new this.objectRegistry[e.id](...this.resolveReferences(e.args));this.objectRegistry[this.localOtherIndexCounter--]=t}handlePropertySet(e){this.objectRegistry[e.id][e.prop]=this.resolveReferences(e.val)}handleDispose(e){void 0!==this.objectRegistry[e.id].dispose&&this.objectRegistry[e.id].dispose(),delete this.objectRegistry[e.id]}receive(e){for(let t in e.data){let s=e.data[t];switch(s.kind){case"ready":this.handleReady();break;case"link":this.handleLinkage(s);break;case"call":this.handleCall(s);break;case"new":this.handleNew(s);break;case"set":this.handlePropertySet(s);break;case"del":this.handleDispose(s)}}}register(e,t){this.objectRegistry[t]=e}createProxy(e){if(!isNaN(e))throw new Error("numeric indices are reserved for anonymous objects");return this._createProxy(e)}_createProxy(e){let t={},s=this;function r(){return"function"==typeof e&&(s.enqueueMsg({kind:"link",path:e()}),e=s.remoteOtherIndexCounter--),e}function n(){s.enqueueMsg({kind:"del",id:r()}),e=void 0}return new Proxy(Object,{set:(e,t,n)=>(s.enqueueMsg({kind:"set",id:r(),prop:t,val:s.referencifyObject(n)}),!0),get:(o,i,a)=>"__ref__"===i?r():"dispose"===i?n:(i in t||(t[i]=s._createProxy(function(e,t){return function(){return"function"==typeof e?[...e(),t]:[e,t]}}(e,i))),t[i]),apply:(e,t,n)=>(s.enqueueMsg({kind:"call",id:r(),args:s.referencifyObject(n)}),s._createProxy(s.remoteOtherIndexCounter--)),construct:(e,t)=>(s.enqueueMsg({kind:"new",id:r(),args:s.referencifyObject(t)}),s._createProxy(s.remoteOtherIndexCounter--))})}referencifyFunction(e){if(void 0===e.__cb__){0;let t=this.localOwnIndexCounter++;return e.__cb__=t,this.objectRegistry[t]=e,{__cb__:"new"}}return{__cb__:e.__cb__}}referencifyChildren(e){let t=Array.isArray(e)?[]:{};for(let s in e){let r=this.referencifyObject(e[s]);"object"==typeof r&&("__cb__"in r&&(t.__cb__=!0),"__ref__"in r&&(t.__ref__=!0)),t[s]=r}return t}referencifyObject(e){switch(typeof e){case"number":case"string":case"boolean":return e;case"object":return this.referencifyChildren(e);case"function":return void 0===e.__ref__?this.referencifyFunction(e):{__ref__:e.__ref__}}throw new Error("unsendable type: "+typeof e)}resolveReferenceMembers(e){if("__cb__"in e){if("number"==typeof e.__cb__)return this._createProxy(e.__cb__);if("new"===e.__cb__)return this._createProxy(this.remoteOwnIndexCounter++);if(!0===e.__cb__){for(let t in e)e[t]=this.resolveReferences(e[t]);return e}throw new Error("unexpected callback reference type")}if("__ref__"in e){if("number"==typeof e.__ref__||"string"==typeof e.__ref__)return this.objectRegistry[e.__ref__];if(!0===e.__ref__){for(let t in e)e[t]=this.resolveReferences(e[t]);return e}throw new Error("unexpected reference type")}return e}resolveReferences(e){switch(typeof e){case"number":case"string":case"boolean":return e;case"object":return this.resolveReferenceMembers(e)}}}let n;void 0!==window.document?(console.log("loading engine"),n=new r("./acechase_engine.js")):n=new r},72:function(e,t,s){"use strict";s.r(t);var r=s(7);var n=s(3),o=s(14);class i extends o.a{constructor(e={}){super(e),this.kind="mesh",Object(n.b)(this,e,["baseColor","accentColor"])}}class a extends i{constructor(e){super(e),this.asset=e.asset}}class c{constructor(e,t){this.note=t,this.check=e}}var l=s(11),h=s(2);const u=new class{constructor(){this.constructors={}}register(e,t){this.constructors[e]=t}createShape(e){if(!this.constructors.hasOwnProperty(e.kind))throw new Error("P2ShapeFactory cannot create a "+e.kind);return new this.constructors[e.kind](e)}};class d{constructor(e,t){this.toBeDeleted=!1,this.p2world=e,this.p2body=new l.Body({mass:1}),Object.assign(this,t);for(let e of t.shapes){let t=u.createShape(e);this.p2body.addShape(t.p2shape)}this.p2world.addBody(this.p2body)}set mass(e){this.p2body.mass=e,this.p2body.updateMassProperties()}get mass(){return this.p2body.mass}set position(e){h.b.copy(this.p2body.position,e)}get position(){return h.b.clone(this.p2body.position)}set velocity(e){h.b.copy(this.p2body.velocity,e)}get velocity(){return h.b.clone(this.p2body.velocity)}set damping(e){this.p2body.damping=e}get damping(){return this.p2body.damping}set angle(e){this.p2body.angle=e}get angle(){return this.p2body.angle}set angularVelocity(e){this.p2body.angularVelocity=e}get angularVelocity(){return this.p2body.angularVelocity}set angularDamping(e){this.p2body.angularDamping=e}get angularDamping(){return this.p2body.angularDamping}applyForce(e,t=h.b.fromValues(0,0)){this.p2body.applyForce([e[0],e[1]],[t[0],t[1]])}applyLocalForce(e,t=h.b.fromValues(0,0)){this.p2body.applyForceLocal([e[0],e[1]],[t[0],t[1]])}applyImpulse(e,t=h.b.fromValues(0,0)){this.p2body.applyImpulse([e[0],e[1]],[t[0],t[1]])}applyLocalImpulse(e,t=h.b.fromValues(0,0)){this.p2body.applyImpulseLocal([e[0],e[1]],[t[0],t[1]])}applyTorque(e){this.p2body.angularForce+=e}applyAngularMomentum(e){this.p2body.angularVelocity+=this.p2body.invInertia*e}remove(){this.p2world.removeBody(this.p2body)}}u.register("circle",class extends class{updateP2(){this.p2shape.updateBoundingRadius(),null!==this.p2shape.body&&(this.p2shape.body.aabbNeedsUpdate=!0,this.p2shape.body.updateBoundingRadius())}set offset(e){h.b.copy(this.p2shape.position,e)}get offset(){return h.b.clone(this.p2shape.position)}set offsetAngle(e){this.p2shape.angle=e}get offsetAngle(){return this.p2shape.angle}}{constructor(e){super(),this.p2shape=new l.Circle,Object.assign(this,e)}set radius(e){this.p2shape.radius=e,this.updateP2()}get radius(){return this.p2shape.radius}set boundingRadius(e){this.p2shape.radius=e,this.updateP2()}get boundingRadius(){return this.p2shape.boundingRadius}});class p extends class{constructor(e){this.offset=h.b.fromValues(0,0),this.offsetAngle=0,this.kind=e.kind,Object(n.b)(this,e,["offset","offsetAngle"])}}{constructor(e){super(e),this.kind="circle",this.radius=1,Object(n.b)(this,e,["radius"])}}class f{constructor(e){this.mass=1,this.position=h.b.fromValues(0,0),this.velocity=h.b.fromValues(0,0),this.damping=.1,this.angle=0,this.angularVelocity=0,this.angularDamping=.1,Object(n.b)(this,e,["shapes","mass","position","velocity","damping","angle","angularVelocity","angularDamping"])}}function b(e,t=Math.PI){let s=(e-t)/2/Math.PI;return 2*(s-Math.floor(s)-1)*Math.PI+t}let y,g,m=new class{constructor(){this.p2world=new l.World({gravity:[0,0]})}addRigidBody(e){return new d(this.p2world,e)}step(e){this.p2world.step(e)}},_=new class{constructor({onItemCheck:e=(e=>{}),onComplete:t=(()=>{})}={}){this.items=new Set,this.numTotalItems=0,this.onItemCheck=e,this.onComplete=t}newItem({onCheck:e=(()=>{}),note:t}={}){this.numTotalItems++;let s=this,r=new c(()=>{e(),s.onItemCheck(r.note),s.items.delete(r),0==s.items.size&&s.onComplete()},t);return this.items.add(r),r}getProgress(){return 1-this.items.size/this.numTotalItems}reset(){this.items.clear(),this.numTotalItems=0}}({onComplete:function(){const e=new f({shapes:[new p({radius:1})],damping:.7,angularDamping:.99}),t=new a({asset:g}),s={getAbsoluteDirection(){},getThrust:()=>1,getTurnRate:()=>1,isShooting:()=>!1,setPauseCallback(e){}};let n=[];for(let r=0;r<50;r++){let r=new j(e,t,s);r.body.position=h.b.fromValues(20*Math.random()-10,20*Math.random()-10),r.body.angle=1e3*Math.random(),n.push(r)}setInterval(()=>{for(let e of n)e.update();m.step(.01),r.a.sendAll()},10)}}),w=_.newItem(),v=_.newItem();setTimeout((function(){y=r.a.createProxy("graphicsServer"),w.check(),g=y.model.load("glider/glider.gltf",v.check),r.a.sendAll()}),0);class j{constructor(e,t,s){this.thrust=0,this.body=m.addRigidBody(e),this.mesh=y.mesh.createFromModel(t),this.controller=s}update(){this.thrust=10*this.controller.getThrust(),this.body.applyLocalForce(h.b.fromValues(this.thrust,0));const e=this.controller.getTurnRate();null!=e&&this.body.applyTorque(10*e);const t=this.controller.getAbsoluteDirection();null!=t&&this.turnToDirection(t),this.mesh.position=[this.body.position[0],this.body.position[1],0],this.mesh.orientation=h.a.fromEuler([0,0,0,0],0,0,this.body.angle/Math.PI*180)}turnToDirection(e){let t=b(this.body.angle),s=b(t-e);if(Math.abs(s)>1e-4){let e=Math.sign(s);this.body.applyAngularMomentum(.3*-e)}}}}});
//# sourceMappingURL=acechase_engine.js.map