var window=self;importScripts("./acechase_lib.js"),function(e){function t(t){for(var r,o,a=t[0],c=t[1],h=t[2],l=0,d=[];l<a.length;l++)o=a[l],Object.prototype.hasOwnProperty.call(n,o)&&n[o]&&d.push(n[o][0]),n[o]=0;for(r in c)Object.prototype.hasOwnProperty.call(c,r)&&(e[r]=c[r]);for(u&&u(t);d.length;)d.shift()();return i.push.apply(i,h||[]),s()}function s(){for(var e,t=0;t<i.length;t++){for(var s=i[t],r=!0,a=1;a<s.length;a++){var c=s[a];0!==n[c]&&(r=!1)}r&&(i.splice(t--,1),e=o(o.s=s[0]))}return e}var r={},n={1:0},i=[];function o(t){if(r[t])return r[t].exports;var s=r[t]={i:t,l:!1,exports:{}};return e[t].call(s.exports,s,s.exports,o),s.l=!0,s.exports}o.m=e,o.c=r,o.d=function(e,t,s){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(o.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)o.d(s,r,function(t){return e[t]}.bind(null,r));return s},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="";var a=window.webpackJsonp=window.webpackJsonp||[],c=a.push.bind(a);a.push=t,a=a.slice();for(var h=0;h<a.length;h++)t(a[h]);var u=c;i.push([73,0]),s()}({11:function(e,t,s){"use strict";s.d(t,"a",(function(){return i}));var r=s(1),n=s(3);class i{constructor(e={}){this.position=r.d.fromValues(0,0,0),this.orientation=r.b.fromValues(0,0,0,1),this.scaling=r.d.fromValues(1,1,1),this.kind=e.kind,Object(n.b)(this,e,["position","orientation","scaling"])}}},15:function(e,t,s){"use strict";s.d(t,"a",(function(){return i}));var r=s(11),n=s(3);class i extends r.a{constructor(e={}){super(e),this.kind="camera",this.nearClip=.1,this.farClip=1e3,this.verticalAngleOfViewInDeg=40,this.onAspectChange=function(e){},Object(n.b)(this,e,["nearClip","farClip","verticalAngleOfViewInDeg"])}}},3:function(e,t,s){"use strict";function r(e,t,s){for(const r of s)e[r]=t[r]}function n(e,t,s){for(const r of s)r in t&&(e[r]=t[r])}s.d(t,"a",(function(){return r})),s.d(t,"b",(function(){return n}))},73:function(e,t,s){"use strict";s.r(t);var r=s(8);var n=s(3),i=s(11);class o extends i.a{constructor(e={}){super(e),this.kind="mesh",Object(n.b)(this,e,["baseColor","accentColor"])}}class a extends o{constructor(e){super(e),this.asset=e.asset}}class c{constructor(e,t){this.note=t,this.check=e}}var h=s(5),u=s(1);class l{updateP2(){this.p2shape.updateBoundingRadius(),null!==this.p2shape.body&&(this.p2shape.body.aabbNeedsUpdate=!0,this.p2shape.body.updateBoundingRadius())}set offset(e){u.c.copy(this.p2shape.position,e)}get offset(){return u.c.clone(this.p2shape.position)}set offsetAngle(e){this.p2shape.angle=e}get offsetAngle(){return this.p2shape.angle}}const d=new class{constructor(){this.constructors={}}register(e,t){this.constructors[e]=t}createShape(e){if(!this.constructors.hasOwnProperty(e.kind))throw new Error("P2ShapeFactory cannot create a "+e.kind);return new this.constructors[e.kind](e)}};class p{constructor(e,t){this.toBeDeleted=!1,this.p2world=e,this.p2body=new h.Body,Object.assign(this,t);for(let e of t.shapes){let t=d.createShape(e);this.p2body.addShape(t.p2shape)}this.p2world.addBody(this.p2body)}set mass(e){e===1/0?this.p2body.type=h.Body.STATIC:(this.p2body.type=h.Body.DYNAMIC,this.p2body.mass=e),this.p2body.updateMassProperties()}get mass(){return this.p2body.type===h.Body.STATIC?1/0:this.p2body.mass}set position(e){u.c.copy(this.p2body.position,e)}get position(){return u.c.clone(this.p2body.position)}set velocity(e){u.c.copy(this.p2body.velocity,e)}get velocity(){return u.c.clone(this.p2body.velocity)}set damping(e){this.p2body.damping=e}get damping(){return this.p2body.damping}set angle(e){this.p2body.angle=e}get angle(){return this.p2body.angle}set angularVelocity(e){this.p2body.angularVelocity=e}get angularVelocity(){return this.p2body.angularVelocity}set angularDamping(e){this.p2body.angularDamping=e}get angularDamping(){return this.p2body.angularDamping}applyForce(e,t=u.c.fromValues(0,0)){this.p2body.applyForce([e[0],e[1]],[t[0],t[1]])}applyLocalForce(e,t=u.c.fromValues(0,0)){this.p2body.applyForceLocal([e[0],e[1]],[t[0],t[1]])}applyImpulse(e,t=u.c.fromValues(0,0)){this.p2body.applyImpulse([e[0],e[1]],[t[0],t[1]])}applyLocalImpulse(e,t=u.c.fromValues(0,0)){this.p2body.applyImpulseLocal([e[0],e[1]],[t[0],t[1]])}applyTorque(e){this.p2body.angularForce+=e}applyAngularMomentum(e){this.p2body.angularVelocity+=this.p2body.invInertia*e}remove(){this.p2world.removeBody(this.p2body)}}d.register("circle",class extends l{constructor(e){super(),this.p2shape=new h.Circle,Object.assign(this,e)}set radius(e){this.p2shape.radius=e,this.updateP2()}get radius(){return this.p2shape.radius}set boundingRadius(e){this.p2shape.radius=e,this.updateP2()}get boundingRadius(){return this.p2shape.boundingRadius}});d.register("triangle",class extends l{constructor(e){super();let t=h.Convex.triangleArea(e.corners[0],e.corners[1],e.corners[2]);Math.abs(t)<1e-100?(this.p2shape=new h.Convex,console.error("degenerate triangle")):this.p2shape=t>0?new h.Convex({vertices:e.corners}):new h.Convex({vertices:[e.corners[0],e.corners[2],e.corners[1]]}),Object.assign(this,e)}set corners(e){this.p2shape.vertices=e,this.updateP2()}get corners(){return this.p2shape.vertices}set boundingRadius(e){if(e<=0)return void console.error("triangle bounding radius must be >0");let t=e/this.p2shape.boundingRadius;for(let e of this.p2shape.vertices)e[0]*=t,e[1]*=t;this.updateP2()}get boundingRadius(){return this.p2shape.boundingRadius}});class f extends class{constructor(e){this.offset=u.c.fromValues(0,0),this.offsetAngle=0,this.kind=e.kind,Object(n.b)(this,e,["offset","offsetAngle"])}}{constructor(e={}){super(e),this.kind="circle",this.radius=1,Object(n.b)(this,e,["radius"])}}class g{constructor(e){this.mass=1,this.position=u.c.fromValues(0,0),this.velocity=u.c.fromValues(0,0),this.damping=.1,this.angle=0,this.angularVelocity=0,this.angularDamping=.1,Object(n.b)(this,e,["shapes","mass","position","velocity","damping","angle","angularVelocity","angularDamping"])}}function y(e,t=Math.PI){let s=(e-t)/2/Math.PI;return 2*(s-Math.floor(s)-1)*Math.PI+t}let b={};function m(e,t,s,r){!function(e,t,s,r){if(e in b){let r=b[e](t);s(r)}else{var n=new XMLHttpRequest;n.addEventListener("load",(function(){let r=this.responseText,n=new Function("{"+Object.keys(t).join()+"}",r);b[e]=n;let i=n(t);s(i)})),void 0!==r&&(n.addEventListener("error",r),n.addEventListener("abort",r)),n.open("GET",e),n.send()}}(e,{graphics:t,physics:s},r)}var _=s(15);class w extends _.a{constructor(e={}){super(e),this.dMin=5,this.marginFactor=1.33,this.tau={xy:1,up:.3,down:2,focus:.3},this.tauFocus=.1,Object(n.b)(this,e,["dMin","tau","tauFocus","marginFactor"])}}class v{constructor(e,t){this.distanceOverWidth=1,this.distanceOverHeight=1,this.locks=new Set,this.camera=e.camera.create(t),this.distanceOverHeight=.5/Math.tan(.5*t.verticalAngleOfViewInDeg/180*Math.PI)*t.marginFactor;let s=this;this.camera.onAspectChange=function(e){s.distanceOverWidth=s.distanceOverHeight/e},this.dMin=t.dMin,this.tau=t.tau,this.currentPosition=t.position,this.currentFocus=u.d.fromValues(0,0,0)}follow(e,t){this.locks.add({body:e,radius:t})}unfollow(e){for(let t of this.locks)t.body===e&&this.locks.delete(t)}update(e){let t=1e12,s=-1e12,r=1e12,n=-1e12;for(let e of this.locks)t=Math.min(t,e.body.position[0]-e.radius),s=Math.max(s,e.body.position[0]+e.radius),r=Math.min(r,e.body.position[1]-e.radius),n=Math.max(n,e.body.position[1]+e.radius);let i=u.d.fromValues((t+s)/2,(r+n)/2,Math.max((s-t)*this.distanceOverWidth,(n-r)*this.distanceOverHeight,this.dMin)),o=Math.exp(-e/this.tau.xy),a=this.currentPosition[2]<i[2]?this.tau.up:this.tau.down,c=Math.exp(-e/a),h=u.d.fromValues(o,o,c),l=Math.exp(-e/this.tau.focus);for(let e=0;e<3;e++)this.currentPosition[e]=(1-h[e])*i[e]+h[e]*this.currentPosition[e];this.currentFocus[0]=(1-l)*this.currentFocus[0]+l*i[0],this.currentFocus[1]=(1-l)*this.currentFocus[1]+l*i[1];let d=u.d.subtract(u.d.create(),this.currentPosition,this.currentFocus);u.d.normalize(d,d);let p=u.d.fromValues(0,1,0),f=u.d.cross(u.d.create(),p,d);u.d.normalize(f,f),u.d.cross(p,d,f);let g=function(e,t,s,r){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=s[0],e[4]=s[1],e[5]=s[2],e[6]=r[0],e[7]=r[1],e[8]=r[2],e}(u.a.create(),f,p,d);this.camera.position=this.currentPosition,this.camera.orientation=u.b.fromMat3(u.b.create(),g)}}let O,j,k,x,M=new class{constructor(){this.p2world=new h.World({gravity:[0,0]})}addRigidBody(e){return new p(this.p2world,e)}step(e){this.p2world.step(e)}},C=new class{constructor({onItemCheck:e=(e=>{}),onComplete:t=(()=>{})}={}){this.items=new Set,this.numTotalItems=0,this.onItemCheck=e,this.onComplete=t}newItem({onCheck:e=(()=>{}),note:t}={}){this.numTotalItems++;let s=this,r=new c(()=>{e(),s.onItemCheck(r.note),s.items.delete(r),0==s.items.size&&s.onComplete()},t);return this.items.add(r),r}getProgress(){return 1-this.items.size/this.numTotalItems}reset(){this.items.clear(),this.numTotalItems=0}}({onComplete:function(){const e=new g({shapes:[new f({radius:1})],damping:.7,angularDamping:.99}),t=new a({asset:j}),s={getAbsoluteDirection(){},getThrust:()=>1,getTurnRate:()=>.5,isShooting:()=>!1,setPauseCallback(e){}};let n=[];for(let r=0;r<10;r++){let r=new V(e,t,s);r.body.position=u.c.fromValues(20*Math.random()-10,20*Math.random()-10),r.body.angle=1e3*Math.random(),n.push(r),x.follow(r.body,1.5)}setInterval(()=>{for(let e of n)e.update();M.step(.01),x.update(.01),r.a.sendAll()},10)}}),I=C.newItem(),P=C.newItem(),R=C.newItem();setTimeout((function(){O=r.a.createProxy("graphicsServer"),O.control.setSceneOrientation([-Math.SQRT1_2,0,0,Math.SQRT1_2]),I.check(),x=new v(O,new w),x.camera.activate(),j=O.model.load("glider/glider.gltf",P.check),m("arenas/testarena2/script.js",O,M,(function(e){k=e,R.check()})),r.a.sendAll()}),0);class V{constructor(e,t,s){this.thrust=0,this.body=M.addRigidBody(e),this.mesh=O.mesh.createFromModel(t),this.controller=s}update(){this.thrust=10*this.controller.getThrust(),this.body.applyLocalForce(u.c.fromValues(this.thrust,0));const e=this.controller.getTurnRate();null!=e&&this.body.applyTorque(10*e);const t=this.controller.getAbsoluteDirection();null!=t&&this.turnToDirection(t),this.mesh.position=[this.body.position[0],this.body.position[1],.1],this.mesh.orientation=u.b.fromEuler([0,0,0,0],0,0,this.body.angle/Math.PI*180)}turnToDirection(e){let t=y(this.body.angle),s=y(t-e);if(Math.abs(s)>1e-4){let e=Math.sign(s);this.body.applyAngularMomentum(.3*-e)}}}},8:function(e,t,s){"use strict";s.d(t,"a",(function(){return n}));window.document,window.document;class r{constructor(e){this.worker=void 0,this.connected=!1,this.sendWhenConnected=!1,this.objectRegistry={},this.localOwnIndexCounter=1,this.localOtherIndexCounter=-1,this.remoteOwnIndexCounter=1,this.remoteOtherIndexCounter=-1,this.msgQueue=[],void 0!==e?(this.worker=new Worker(e),this.worker.onmessage=this.receive.bind(this)):(onmessage=this.receive.bind(this),this.enqueueMsg({kind:"ready"}),this.sendAll(),this.connected=!0)}enqueueMsg(e){this.msgQueue.push(e)}sendAll(){0!=this.msgQueue.length&&(void 0!==this.worker?this.connected?(this.worker.postMessage(this.msgQueue),this.msgQueue=[]):this.sendWhenConnected=!0:(postMessage(this.msgQueue),this.msgQueue=[]))}handleReady(){this.connected=!0,this.sendWhenConnected&&this.sendAll()}handleLinkage(e){let t=this.objectRegistry;for(let s of e.path){let e=t[s];"function"==typeof e&&(e=e.bind(t)),t=e}if("object"!=typeof t&&"function"!=typeof t)throw new Error("tried to link a field which is not an object or a method: "+e.path);this.objectRegistry[this.localOtherIndexCounter--]=t}handleCall(e){let t=this.objectRegistry[e.id](...this.resolveReferences(e.args));"object"==typeof t||"function"==typeof t?this.objectRegistry[this.localOtherIndexCounter--]=t:(void 0!==t&&console.warn("result of remotely called function will be ignored"),this.localOtherIndexCounter--)}handleNew(e){let t=new this.objectRegistry[e.id](...this.resolveReferences(e.args));this.objectRegistry[this.localOtherIndexCounter--]=t}handlePropertySet(e){this.objectRegistry[e.id][e.prop]=this.resolveReferences(e.val)}handleDispose(e){void 0!==this.objectRegistry[e.id].dispose&&this.objectRegistry[e.id].dispose(),delete this.objectRegistry[e.id]}receive(e){for(let t in e.data){let s=e.data[t];switch(s.kind){case"ready":this.handleReady();break;case"link":this.handleLinkage(s);break;case"call":this.handleCall(s);break;case"new":this.handleNew(s);break;case"set":this.handlePropertySet(s);break;case"del":this.handleDispose(s)}}}register(e,t){this.objectRegistry[t]=e}createProxy(e){if(!isNaN(e))throw new Error("numeric indices are reserved for anonymous objects");return this._createProxy(e)}_createProxy(e){let t={},s=this;function r(){return"function"==typeof e&&(s.enqueueMsg({kind:"link",path:e()}),e=s.remoteOtherIndexCounter--),e}function n(){s.enqueueMsg({kind:"del",id:r()}),e=void 0}return new Proxy(Object,{set:(e,t,n)=>(s.enqueueMsg({kind:"set",id:r(),prop:t,val:s.referencifyObject(n)}),!0),get:(i,o,a)=>"__ref__"===o?r():"dispose"===o?n:(o in t||(t[o]=s._createProxy(function(e,t){return function(){return"function"==typeof e?[...e(),t]:[e,t]}}(e,o))),t[o]),apply:(e,t,n)=>(s.enqueueMsg({kind:"call",id:r(),args:s.referencifyObject(n)}),s._createProxy(s.remoteOtherIndexCounter--)),construct:(e,t)=>(s.enqueueMsg({kind:"new",id:r(),args:s.referencifyObject(t)}),s._createProxy(s.remoteOtherIndexCounter--))})}referencifyFunction(e){if(void 0===e.__cb__){0;let t=this.localOwnIndexCounter++;return e.__cb__=t,this.objectRegistry[t]=e,{__cb__:"new"}}return{__cb__:e.__cb__}}referencifyChildren(e){let t=Array.isArray(e)?[]:{};for(let s in e){let r=this.referencifyObject(e[s]);"object"==typeof r&&("__cb__"in r&&(t.__cb__=!0),"__ref__"in r&&(t.__ref__=!0)),t[s]=r}return t}referencifyObject(e){switch(typeof e){case"number":case"string":case"boolean":return e;case"object":return this.referencifyChildren(e);case"function":return void 0===e.__ref__?this.referencifyFunction(e):{__ref__:e.__ref__}}throw new Error("unsendable type: "+typeof e)}resolveReferenceMembers(e){if("__cb__"in e){if("number"==typeof e.__cb__)return this._createProxy(e.__cb__);if("new"===e.__cb__)return this._createProxy(this.remoteOwnIndexCounter++);if(!0===e.__cb__){for(let t in e)e[t]=this.resolveReferences(e[t]);return e}throw new Error("unexpected callback reference type")}if("__ref__"in e){if("number"==typeof e.__ref__||"string"==typeof e.__ref__)return this.objectRegistry[e.__ref__];if(!0===e.__ref__){for(let t in e)e[t]=this.resolveReferences(e[t]);return e}throw new Error("unexpected reference type")}return e}resolveReferences(e){switch(typeof e){case"number":case"string":case"boolean":return e;case"object":return this.resolveReferenceMembers(e)}}}let n;void 0!==window.document?(console.log("loading engine"),n=new r("./acechase_engine.js")):n=new r}});
//# sourceMappingURL=acechase_engine.js.map